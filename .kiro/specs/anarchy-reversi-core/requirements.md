# Requirements Document

## Introduction

「アナーキーオセロ」のコア機能に関する要件定義書。従来のリバーシルールに縛られず、子供が自由に石を操作できるWeb版リバーシゲームを実現する。リアルタイム対戦機能を備え、ルームIDの共有により友達と対戦できることを目指す。

技術スタック: React（TypeScript） + Go（Gin） + Redis + WebSocket

## Requirements

### Requirement 1: ゲームボード表示

**Objective:** プレイヤーとして、8x8のリバーシ盤面を画面上で確認したい。直感的に石の配置状況を把握できるようにするため。

#### Acceptance Criteria

1. The アナーキーオセロ shall 8x8（64マス）のグリッド形式でゲームボードを表示する
2. The アナーキーオセロ shall 各セルの状態を黒石・白石・空の3種類で視覚的に区別して表示する
3. When ゲームが初期化された時, the アナーキーオセロ shall 中央4マス（d4=白, e4=黒, d5=黒, e5=白）に初期配置を行う
4. The アナーキーオセロ shall スマートフォン・タブレット・デスクトップの各画面サイズに対応したレスポンシブな盤面表示を提供する
5. The アナーキーオセロ shall 子供が操作しやすい十分な大きさのセルタッチターゲットを確保する

### Requirement 2: 石の自由操作と手番管理

**Objective:** プレイヤーとして、自分の手番に盤面上の任意のマスをクリックして石を自分の色に変更したい。手番の概念がありつつも、合法手に縛られず自由に遊べるようにするため。

#### Acceptance Criteria

1. The アナーキーオセロ shall 現在の手番（黒番・白番）を管理し、画面上に表示する
2. When ゲームが初期化された時, the アナーキーオセロ shall 黒番から開始する
3. While 黒番の時, When プレイヤーが空のセルまたは白石のセルをクリックした時, the アナーキーオセロ shall そのセルを黒石に変更する
4. While 白番の時, When プレイヤーが空のセルまたは黒石のセルをクリックした時, the アナーキーオセロ shall そのセルを白石に変更する
5. The アナーキーオセロ shall 合法手の判定を行わず、すべてのセルを操作可能にする
6. The アナーキーオセロ shall 1手番中の操作回数に制限を設けない
7. When プレイヤーが「手番終了」ボタンを押した時, the アナーキーオセロ shall 手番を相手に切り替える（黒番→白番、白番→黒番）
8. When セルがクリックされた時, the アナーキーオセロ shall 即座に視覚的なフィードバック（石の変更表示）を提供する

### Requirement 3: ルーム作成

**Objective:** プレイヤーとして、新しい対戦ルームを作成したい。友達と対戦するための場を用意するため。

#### Acceptance Criteria

1. When プレイヤーがルーム作成を要求した時, the アナーキーオセロ shall 一意なルームIDを生成してルームを作成する
2. When ルームが作成された時, the アナーキーオセロ shall ルームIDを画面上に表示する
3. The アナーキーオセロ shall ユーザー登録やログインを必要とせずにルームを作成可能にする
4. When ルームが作成された時, the アナーキーオセロ shall 作成者をそのルームに自動的に接続する

### Requirement 4: ルーム参加

**Objective:** プレイヤーとして、共有されたルームIDを使って既存のルームに参加したい。友達が作成したルームで一緒に遊ぶため。

#### Acceptance Criteria

1. When プレイヤーがルームIDを入力して参加を要求した時, the アナーキーオセロ shall 指定されたルームに接続する
2. If 存在しないルームIDが入力された場合, then the アナーキーオセロ shall エラーメッセージを表示してルームが見つからない旨を通知する
3. When ルーム参加が成功した時, the アナーキーオセロ shall 現在の盤面状態を参加者に同期して表示する
4. The アナーキーオセロ shall ユーザー登録やログインを必要とせずにルームに参加可能にする

### Requirement 5: リアルタイム盤面同期

**Objective:** プレイヤーとして、対戦相手の操作がリアルタイムで自分の画面に反映されてほしい。スムーズなオンライン対戦を楽しむため。

#### Acceptance Criteria

1. When プレイヤーがセルを操作した時, the アナーキーオセロ shall 同じルーム内の全プレイヤーの盤面にその変更をリアルタイムで反映する
2. The アナーキーオセロ shall WebSocketを使用して低遅延のリアルタイム通信を実現する
3. While プレイヤーがルームに接続中, the アナーキーオセロ shall 盤面状態の一貫性を維持する
4. When 新しいプレイヤーがルームに参加した時, the アナーキーオセロ shall 最新の盤面状態をそのプレイヤーに同期する

### Requirement 6: スコア表示

**Objective:** プレイヤーとして、黒石と白石の数をリアルタイムで確認したい。ゲームの状況を把握するため。

#### Acceptance Criteria

1. The アナーキーオセロ shall 盤面上の黒石の数と白石の数をスコアとして常時表示する
2. When 盤面の石が変更された時, the アナーキーオセロ shall スコアを即座に再計算して表示を更新する
3. The アナーキーオセロ shall 黒石と白石のスコアを視覚的に区別して表示する

### Requirement 7: ゲームリセット

**Objective:** プレイヤーとして、ゲームをリセットして最初からやり直したい。新しいゲームを開始するため。

#### Acceptance Criteria

1. When プレイヤーがリセットを要求した時, the アナーキーオセロ shall 盤面を初期状態（中央4マス配置）に戻す
2. When ゲームがリセットされた時, the アナーキーオセロ shall 同じルーム内の全プレイヤーの盤面もリセットする
3. When ゲームがリセットされた時, the アナーキーオセロ shall スコア表示を初期状態に更新する
4. When ゲームがリセットされた時, the アナーキーオセロ shall 手番を黒番に初期化する

### Requirement 8: 接続管理

**Objective:** プレイヤーとして、安定した接続状態でゲームを楽しみたい。接続問題による操作不能を防ぐため。

#### Acceptance Criteria

1. The アナーキーオセロ shall WebSocket接続の状態（接続中・切断中）をプレイヤーに表示する
2. If WebSocket接続が切断された場合, then the アナーキーオセロ shall 自動的に再接続を試みる
3. When 再接続に成功した時, the アナーキーオセロ shall 最新の盤面状態を復元して表示する
4. If 再接続が失敗した場合, then the アナーキーオセロ shall 接続エラーの旨をプレイヤーに通知する

### Requirement 9: ゲーム状態の永続化

**Objective:** システムとして、ゲーム状態を一時的に永続化したい。接続断や再参加時にゲームを継続できるようにするため。

#### Acceptance Criteria

1. The アナーキーオセロ shall ルーム情報と盤面状態をRedisに保存する
2. The アナーキーオセロ shall ゲーム状態にTTL（有効期限）を設定し、非アクティブなルームを自動削除する
3. When プレイヤーが既存のルームに再接続した時, the アナーキーオセロ shall Redisから最新の盤面状態を復元する

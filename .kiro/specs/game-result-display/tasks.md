# Implementation Plan

- [ ] 1. ゲーム終了判定の状態管理を実装する
- [ ] 1.1 ゲーム終了状態と勝者情報の型定義を追加する
  - ゲーム結果を表す型（黒勝ち・白勝ち・引き分け）を定義する
  - ゲーム状態に終了フラグと勝者フィールドを追加する
  - 初期値は未終了・勝者なしとする
  - _Requirements: 1.1, 1.2, 1.3_

- [ ] 1.2 手番終了時にゲーム終了を検出して勝者を判定するロジックを追加する
  - 手番終了処理で、既存の手番切り替え・自動パスロジックの後に終了判定を追加する
  - 両プレイヤーとも合法手がない場合にゲーム終了状態に遷移させる
  - スコア比較で勝者を判定し、同数の場合は引き分けとする
  - _Requirements: 1.1, 1.2, 1.3_

- [ ] 1.3 ゲーム終了中の操作ロックを実装する
  - 石の配置リデューサーの先頭でゲーム終了チェックを追加し、終了中は操作を拒否する
  - 石の裏返しリデューサーの先頭でゲーム終了チェックを追加し、終了中は操作を拒否する
  - ゲームリセット時に終了フラグと勝者を初期値に戻すことを確認する
  - _Requirements: 1.4_

- [ ] 1.4 ゲーム終了判定のユニットテストを作成する
  - 両者合法手なし時にゲーム終了状態になること（黒勝ち・白勝ち・引き分けの3パターン）
  - 一方のみ合法手なし（自動パス）ではゲームが続行されること
  - ゲーム終了中に石の配置・裏返し操作が状態を変更しないこと
  - リセット時にゲーム終了状態が初期化されること
  - _Requirements: 1.1, 1.2, 1.3, 1.4_

- [ ] 2. ゲーム結果ダイアログコンポーネントを実装する
- [ ] 2.1 canvas-confettiライブラリをインストールする
  - canvas-confettiとその型定義をプロジェクトに追加する
  - _Requirements: 2.5_

- [ ] 2.2 クラッカーアニメーションコンポーネントを作成する
  - 勝者が決定した場合（引き分け以外）にクラッカーパーティクルを画面全体に発火するコンポーネントを作成する
  - 左右2方向からの射出パターンでアニメーションを表現する
  - `prefers-reduced-motion`設定を尊重してアクセシビリティに配慮する
  - アニメーションは一度だけ発火し、ループしない
  - 引き分けの場合はアニメーションを発火しない
  - canvas-confettiの呼び出しをtry/catchで囲み、失敗時は無視する
  - _Requirements: 2.5, 2.6_

- [ ] 2.3 ゲーム結果表示ダイアログの基本構造を実装する
  - モーダルオーバーレイ形式で結果画面を表示する（既存の「遊び方」ダイアログと同じパターン）
  - 勝者の色（黒勝ち・白勝ち）または引き分けをわかりやすいメッセージで表示する
  - 最終スコア（黒石数・白石数）を表示する
  - 子供向けに大きな文字と視覚的な表現を使用する（ひらがな表記、色付きの石アイコン）
  - 勝者がいる場合はクラッカーアニメーションコンポーネントを表示する
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5, 2.6_

- [ ] 2.4 結果ダイアログの操作機能を実装する
  - 「もう一回あそぶ」ボタンを表示し、クリック時にコールバックを呼び出す
  - 背景クリックでダイアログを閉じる（最終盤面確認用）
  - Escapeキーでダイアログを閉じる
  - _Requirements: 3.1, 3.3_

- [ ] 2.5 結果ダイアログのアクセシビリティを実装する
  - `role="dialog"`, `aria-modal="true"`, `aria-label`属性を設定する
  - ダイアログ表示時にフォーカスをダイアログ内に移動する
  - ボタンにキーボード操作（Enter/Space）でアクセスできるようにする
  - `aria-live="assertive"`で勝敗結果をスクリーンリーダーに通知する
  - _Requirements: 5.1, 5.2, 5.3, 5.4_

- [ ] 2.6 結果ダイアログとアニメーションのコンポーネントテストを作成する
  - 勝者表示の3パターン（黒勝ち・白勝ち・引き分け）が正しく表示されること
  - 最終スコアが正しく表示されること
  - 「もう一回あそぶ」ボタンクリックでコールバックが呼ばれること
  - 背景クリックでonCloseコールバックが呼ばれること
  - EscapeキーでonCloseコールバックが呼ばれること
  - ARIA属性（role, aria-modal, aria-label）が正しく設定されること
  - キーボード操作（Enter/Space）でボタンが動作すること
  - クラッカーアニメーションが勝者決定時のみ発火すること（canvas-confettiをモック）
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 3.1, 3.3, 5.1, 5.2, 5.3, 5.4_

- [ ] 3. 既存コンポーネントにゲーム終了時のUI更新を統合する
- [ ] 3.1 (P) 手番表示コンポーネントにゲーム終了対応を追加する
  - ゲーム終了フラグを受け取るpropsを追加する
  - ゲーム終了時に手番表示を「ゲームしゅうりょう！」メッセージに切り替える
  - ゲーム終了時に「手番終了」ボタンを非表示にし、代わりに「結果を見る」ボタンを表示する
  - 「結果を見る」ボタンのコールバックpropsを追加する
  - _Requirements: 4.1, 4.2, 3.4_

- [ ] 3.2 (P) スコアボードに勝者ハイライトを追加する
  - 勝者情報を受け取るオプションのpropsを追加する
  - 勝者のスコアパネルにハイライトスタイルを適用する
  - 引き分け時は両方のパネルを同等に表示する
  - 未終了時は既存の手番ハイライトを維持する
  - _Requirements: 4.3_

- [ ] 3.3 手番表示・スコアボードの拡張テストを作成する
  - ゲーム終了時に手番表示が切り替わること
  - ゲーム終了時に「結果を見る」ボタンが表示されること
  - 勝者ハイライトが正しく適用されること（黒勝ち・白勝ち・引き分け）
  - _Requirements: 3.4, 4.1, 4.2, 4.3_

- [ ] 4. ゲームページに結果表示フローを統合する
- [ ] 4.1 ゲームページに結果ダイアログの表示制御を組み込む
  - Redux storeからゲーム終了フラグと勝者情報を読み取る
  - ゲーム終了検出時に結果ダイアログを自動表示するローカルstateとuseEffectを追加する
  - 「もう一回あそぶ」ボタンでゲームリセットとダイアログ閉じを行うハンドラを追加する
  - 背景クリックでダイアログを閉じた後、「結果を見る」ボタンで再表示できるようにする
  - 手番表示コンポーネントとスコアボードに新しいpropsを伝搬する
  - _Requirements: 3.2, 3.4, 4.1, 4.2, 4.3_

- [ ] 4.2 統合動作を確認するテストを作成する
  - ゲーム終了時に結果ダイアログが表示されること
  - 「もう一回あそぶ」でゲームがリセットされること
  - ダイアログを閉じた後に「結果を見る」で再表示できること
  - ゲーム終了中に盤面操作が無効化されていること
  - _Requirements: 3.2, 3.4_
